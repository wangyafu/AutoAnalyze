# 前端文件清单

基于项目需求和API文档，以下是DeepAnalyze前端部分的文件清单，包括每个文件的作用和对外暴露的接口。

## 项目结构

```
d:/deep/frontend/
├── public/                  # 静态资源
├── src/                     # 源代码
│   ├── api/                 # API接口封装
│   ├── assets/              # 静态资源
│   ├── components/          # 通用组件
│   ├── composables/         # 组合式函数
│   ├── layouts/             # 布局组件
│   ├── router/              # 路由配置
│   ├── stores/              # 状态管理
│   ├── types/               # TypeScript类型定义
│   ├── utils/               # 工具函数
│   ├── views/               # 页面视图
│   ├── App.vue              # 根组件
│   ├── main.ts              # 入口文件
│   └── env.d.ts             # 环境变量类型定义
├── .env                     # 环境变量
├── index.html               # HTML模板
├── package.json             # 项目依赖
├── tsconfig.json            # TypeScript配置
└── vite.config.ts           # Vite配置
```

## 核心文件详解

### 1. API接口封装 (`src/api/`)

#### `src/api/index.ts`
- **作用**：API模块的统一导出
- **接口**：导出所有API模块

#### `src/api/http.ts`
- **作用**：提供配置好的axios实例
- **接口**：
  - `httpClient`: 预配置的axios实例
  - `setBaseURL(url)`: 设置基础URL


#### `src/api/websocket.ts`
- **作用**：封装WebSocket连接和消息处理
- **接口**：
  - `createWebSocketClient()`: 创建WebSocket客户端
  - `connect()`: 建立连接
  - `disconnect()`: 断开连接
  - `subscribe(topic, callback)`: 订阅主题
  - `unsubscribe(topic)`: 取消订阅
  - `sendMessage(type, data)`: 发送消息

#### `src/api/conversation.ts`
- **作用**：对话相关API
- **接口**：
  - `getConversations(limit?, offset?)`: 获取对话列表
  - `getConversation(id)`: 获取单个对话详情
  - `createConversation(title)`: 创建新对话
  - `deleteConversation(id)`: 删除对话
  - `sendUserMessage(conversationId, content)`: 发送用户消息

#### `src/api/execution.ts`
- **作用**：代码执行相关API
- **接口**：
  - `executeCode(conversationId, code, executionId?)`: 执行代码
  - `cancelExecution(executionId)`: 取消代码执行

#### `src/api/filesystem.ts`
- **作用**：文件系统相关API
- **接口**：
  - `setWorkspace(path)`: 设置工作目录
  - `getFiles(path?)`: 获取文件目录结构
  - `getFilePreview(path, maxSize?)`: 获取文件内容预览
  - `getTextFileContent(path)`: 获取文本文件完整内容

#### `src/api/config.ts`
- **作用**：系统配置相关API
- **接口**：
  - `getStatus()`: 获取系统状态
  - `updateConfig(config)`: 更新系统配置

### 2. 状态管理 (`src/stores/`)

#### `src/stores/conversation.ts`
- **作用**：管理对话状态
- **接口**：
  - `conversations`: 对话列表
  - `currentConversation`: 当前对话
  - `loadConversations()`: 加载对话列表
  - `loadConversation(id)`: 加载单个对话
  - `createConversation(title)`: 创建对话
  - `deleteConversation(id)`: 删除对话
  - `sendMessage(content)`: 发送消息
  - `addMessage(message)`: 添加消息到当前对话

#### `src/stores/execution.ts`
- **作用**：管理代码执行状态
- **接口**：
  - `executions`: 执行记录
  - `currentExecution`: 当前执行
  - `executeCode(code)`: 执行代码
  - `cancelExecution()`: 取消执行
  - `updateExecutionStatus(id, status)`: 更新执行状态
  - `addExecutionOutput(id, output)`: 添加执行输出

#### `src/stores/filesystem.ts`
- **作用**：管理文件系统状态
- **接口**：
  - `workspace`: 当前工作目录
  - `files`: 文件列表
  - `setWorkspace(path)`: 设置工作目录
  - `loadFiles(path?)`: 加载文件列表
  - `getFilePreview(path)`: 获取文件预览
  - `handleFileSystemChange(event)`: 处理文件系统变更

#### `src/stores/config.ts`
- **作用**：管理系统配置
- **接口**：
  - `config`: 系统配置
  - `status`: 系统状态
  - `loadStatus()`: 加载系统状态
  - `updateConfig(config)`: 更新配置

### 3. 组件 (`src/components/`)

#### 文件系统组件

##### `src/components/filesystem/FileExplorer.vue`
- **作用**：文件浏览器组件
- **接口**：
  - **Props**:
    - `rootPath`: 根目录路径
  - **事件**:
    - `file-select`: 文件选择事件
    - `directory-select`: 目录选择事件

##### `src/components/filesystem/FileTree.vue`
- **作用**：文件树组件
- **接口**：
  - **Props**:
    - `items`: 文件项列表
    - `expanded`: 展开的节点
  - **事件**:
    - `node-click`: 节点点击事件
    - `node-toggle`: 节点展开/折叠事件

##### `src/components/filesystem/FilePreview.vue`
- **作用**：文件预览组件
- **接口**：
  - **Props**:
    - `file`: 文件对象
    - `content`: 文件内容
    - `type`: 文件类型，支持'text'、'image'等
  - **事件**:
    - `close`: 关闭预览事件
    - `open-external`: 在外部打开文件事件

##### `src/components/filesystem/TextFileViewer.vue`
- **作用**：文本文件查看器
- **接口**：
  - **Props**:
    - `content`: 文件内容
    - `language`: 代码语言（用于语法高亮）
    - `fileName`: 文件名
  - **事件**:
    - `copy`: 复制内容事件

#### 对话组件

##### `src/components/chat/ChatWindow.vue`
- **作用**：聊天窗口组件
- **接口**：
  - **Props**:
    - `conversation`: 对话对象
  - **事件**:
    - `send-message`: 发送消息事件
    - `execute-code`: 执行代码事件

##### `src/components/chat/MessageList.vue`
- **作用**：消息列表组件
- **接口**：
  - **Props**:
    - `messages`: 消息列表

##### `src/components/chat/MessageItem.vue`
- **作用**：单条消息组件
- **接口**：
  - **Props**:
    - `message`: 消息对象
  - **事件**:
    - `execute-code`: 执行代码事件

##### `src/components/chat/CodeBlock.vue`
- **作用**：代码块组件
- **接口**：
  - **Props**:
    - `code`: 代码内容
    - `language`: 代码语言
    - `id`: 代码块ID
  - **事件**:
    - `execute`: 执行代码事件
    - `copy`: 复制代码事件

##### `src/components/chat/MessageInput.vue`
- **作用**：消息输入组件
- **接口**：
  - **Props**:
    - `placeholder`: 占位文本
    - `disabled`: 是否禁用
  - **事件**:
    - `submit`: 提交消息事件

#### 执行组件

##### `src/components/execution/ExecutionPanel.vue`
- **作用**：代码执行面板
- **接口**：
  - **Props**:
    - `execution`: 执行对象
  - **事件**:
    - `cancel`: 取消执行事件

##### `src/components/execution/ExecutionOutput.vue`
- **作用**：执行输出组件
- **接口**：
  - **Props**:
    - `output`: 输出内容
    - `type`: 输出类型

##### `src/components/execution/FigureViewer.vue`
- **作用**：图表查看器
- **接口**：
  - **Props**:
    - `figure`: 图表对象

### 4. 视图 (`src/views/`)

#### `src/views/HomeView.vue`
- **作用**：主页视图
- **接口**：无对外接口，整合各组件

#### `src/views/WorkspaceView.vue`
- **作用**：工作区视图
- **接口**：无对外接口，整合文件浏览和聊天功能

#### `src/views/SettingsView.vue`
- **作用**：设置视图
- **接口**：无对外接口，提供配置界面

#### `src/views/FigureView.vue`
- **作用**：图表查看视图
- **接口**：
  - **路由参数**:
    - `figureId`: 图表ID

### 5. 组合式函数 (`src/composables/`)

#### `src/composables/useWebSocket.ts`
- **作用**：WebSocket连接管理
- **接口**：
  - `isConnected`: 连接状态
  - `connect()`: 建立连接
  - `disconnect()`: 断开连接
  - `subscribe(topic, callback)`: 订阅主题
  - `unsubscribe(topic)`: 取消订阅
  - `sendMessage(type, data)`: 发送消息

#### `src/composables/useCodeExecution.ts`
- **作用**：代码执行管理
- **接口**：
  - `isExecuting`: 是否正在执行
  - `output`: 执行输出
  - `executeCode(code)`: 执行代码
  - `cancelExecution()`: 取消执行

#### `src/composables/useFileSystem.ts`
- **作用**：文件系统操作
- **接口**：
  - `files`: 文件列表
  - `currentPath`: 当前路径
  - `isLoading`: 是否加载中
  - `setWorkspace(path)`: 设置工作目录
  - `navigateTo(path)`: 导航到指定路径
  - `refreshFiles()`: 刷新文件列表
  - `getFilePreview(path)`: 获取文件预览
  - `addMessage(message)`: 添加消息到当前对话

#### `src/composables/useChat.ts`
- **作用**：对话管理与消息处理
- **接口**：
  
  - `sendMessage(content)`: 发送消息并获取回复
  - `parseCodeBlocks(content)`: 从消息内容中解析代码块
  - `extractLanguage(codeBlock)`: 从代码块中提取语言标识
  

### 6. 工具函数 (`src/utils/`)

#### `src/utils/formatter.ts`
- **作用**：格式化工具
- **接口**：
  - `formatDate(date)`: 格式化日期
  - `formatFileSize(size)`: 格式化文件大小
  - `formatCodeLanguage(language)`: 格式化代码语言
  - `getFileType(fileName)`: 根据文件名判断文件类型
  - `isTextFile(fileName)`: 判断是否为文本文件
  - `getLanguageByExtension(extension)`: 根据扩展名获取语言


### 7. 路由配置 (`src/router/`)

#### `src/router/index.ts`
- **作用**：路由配置
- **接口**：
  - 导出路由实例

#### `src/router/routes.ts`
- **作用**：路由定义
- **接口**：
  - 导出路由配置数组

### 8. 类型定义 (`src/types/`)

#### `src/types/api.ts`
- **作用**：API相关类型定义
- **接口**：导出API请求和响应类型

#### `src/types/conversation.ts`
- **作用**：对话相关类型定义
- **接口**：导出对话和消息类型

#### `src/types/execution.ts`
- **作用**：执行相关类型定义
- **接口**：导出执行和输出类型

#### `src/types/filesystem.ts`
- **作用**：文件系统相关类型定义
- **接口**：导出文件和目录类型

## 组件通信流程

1. **文件浏览 → 对话**：
   - 用户在文件浏览器中选择文件
   - `FileExplorer` 触发 `file-select` 事件
   - `WorkspaceView` 捕获事件并更新当前选中文件
   - 文件路径可以在对话中引用

2. **对话 → 代码执行**：
   - 用户在对话中点击代码块的执行按钮
   - `CodeBlock` 触发 `execute` 事件
   - `ChatWindow` 捕获事件并调用 `executeCode` 方法
   - 执行状态和结果通过 WebSocket 实时更新

3. **代码执行 → 图表查看**：
   - 代码执行产生图表输出
   - `ExecutionOutput` 显示图表预览
   - 用户点击图表预览
   - 路由导航到 `FigureView` 查看完整图表

## 状态管理流程

1. **用户认证流**：
   - 用户输入base_url,模型名称，API密钥
   - `config` store更新配置
   - API客户端更新认证信息

2. **工作区设置流**：
   - 用户选择工作目录
   - `filesystem` store更新工作区
   - 文件浏览器显示目录内容

3. **对话创建流**：
   - 用户创建新对话
   - `conversation` store添加对话
   - 路由导航到新对话

4. **消息发送流**：
   - 用户发送消息
   - `conversation` store添加用户消息
   - WebSocket发送消息到后端
   - 后端返回助手消息
   - `conversation` store添加助手消息

5. **代码执行流**：
   - 用户执行代码
   - `execution` store创建执行记录
   - WebSocket订阅执行结果
   - 后端返回执行状态和输出
   - `execution` store更新执行记录

# 前端文件清单（续）

## 数据流设计

### 1. 前端初始化流程

1. **应用启动**:
   - 加载配置信息
   - 检查系统状态
   - 初始化WebSocket连接

2. **工作区设置**:
   - 用户选择或输入工作目录路径
   - 前端发送设置工作目录请求
   - 后端返回目录结构
   - 前端渲染文件树

### 2. 对话交互流程

1. **创建对话**:
   - 用户点击"新建对话"
   - 前端创建对话并切换到对话界面
   - 后端保存对话信息

2. **发送消息**:
   - 用户输入分析需求
   - 前端通过WebSocket发送消息
   - 后端转发至大模型
   - 大模型生成回复
   - 前端接收并显示回复

3. **代码执行**:
   - 用户点击代码块的执行按钮
   - 前端发送执行请求
   - 后端在安全环境中执行代码
   - 执行结果通过WebSocket实时返回
   - 前端展示执行结果

### 3. 文件操作流程

1. **文件浏览**:
   - 用户在文件树中导航
   - 前端请求子目录内容
   - 后端返回目录结构
   - 前端更新文件树

2. **文件预览**:
   - 用户点击文件
   - 前端请求文件预览
   - 后端返回文件内容
   - 前端显示文件预览

## 错误处理策略

### 1. 网络错误

- **连接断开**:
  - 自动重连机制
  - 显示连接状态指示器
  - 重连成功后恢复会话

- **请求超时**:
  - 超时提示
  - 重试机制
  - 降级处理

### 2. 执行错误

- **代码执行错误**:
  - 显示详细错误信息
  - 提供修复建议
  - 允许修改后重新执行

- **资源限制错误**:
  - 显示资源使用情况
  - 提供优化建议

### 3. 模型错误

- **模型连接错误**:
  - 检查API配置
  - 提供配置修复指南

- **模型响应错误**:
  - 显示错误详情
  - 提供重试选项

## 性能优化策略

### 1. 加载优化

- **懒加载**:
  - 路由懒加载
  - 组件懒加载
  - 数据懒加载

- **预加载**:
  - 预加载常用组件
  - 预加载可能需要的数据

### 2. 渲染优化

- **虚拟滚动**:
  - 长列表使用虚拟滚动
  - 只渲染可视区域内的项目

- **防抖与节流**:
  - 输入框使用防抖
  - 滚动事件使用节流

### 3. 缓存策略

- **数据缓存**:
  - 缓存文件目录结构
  - 缓存文件预览
  - 缓存对话历史

- **组件缓存**:
  - 使用`keep-alive`缓存路由组件
  - 缓存频繁使用的组件实例





## 测试策略

### 1. 单元测试


- **工具函数测试**:
  - 测试格式化函数
  - 测试验证函数

- **页面流程测试**:
  - 测试对话流程
  - 测试文件操作流程
  - 测试代码执行流程

- **API集成测试**:
  - 测试API请求
  - 测试WebSocket通信


## 部署与构建

### 1. 构建配置

- **开发环境**:
  - 热重载
  - 源码映射
  - 开发服务器代理


### 2. 部署策略
由于项目部署在用户的电脑上，因此不需要进行打包操作。
